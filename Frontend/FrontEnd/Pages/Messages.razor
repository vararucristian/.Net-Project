@page "/messages"
@layout MainLayout
@inject HttpClient Http
@inject LocationService  LocationService
@inject NavigationManager NavigationManager
@using System.IO


<div class="flex rounded overflow-hidden w-4/5 h-local-custom m-local-custom shadow-lg">

    <div class="bg-grey-darkest text-purple-lighter w-15">

        <div class="py-8 px-4 mb-3 font-sans">Direct Messages</div>




        <div class="flex items-center mb-3 px-4">
            <img src="http://www.garten-und-pflasterbau.de/Images/no-user-img.png" class="w-10 h-10 rounded mr-3" />
            <span class="text-purple-lightest">Adam Bishop</span>
        </div>

        <div class="flex items-center px-4 mb-6">
            <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
            <span class="text-purple-lightest">killgt</span>
            <img src="new_message.png" class="mx-4 w-auto h-10" />
        </div>

    </div>

    <!-- Chat content -->
    <div class="pt-8 w-full flex flex-col ">
        <!-- Top bar -->
        <div class="pt-8 w-full flex flex-col overflow-x-scroll">
            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>

            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>

            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>

            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>


            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>


            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>



            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>


            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>


            <!-- Chat messages -->
            <div class="px-8 -py-2 -mt-8 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>
            </div>

            <div class="px-8 -py-2 -mt-8 flex-1 ">
                <!-- A message -->
                <div class="flex items-start mt-8 mb-8">
                    <img src="https://avatars2.githubusercontent.com/u/343407?s=460&v=4" class="w-10 h-10 rounded mr-3" />
                    <div class="flex flex-col">
                        <div class="flex items-end">
                            <span class="font-bold text-md mr-2 font-sans">killgt</span>
                            <span class="text-grey text-xs font-light">11:46</span>
                        </div>
                        <p class="font-light text-md text-grey-darkest pt-1">The slack from the other side.</p>
                    </div>
                </div>

            </div>



        </div>
        <div class="flex m-6 rounded-lg border-2 border-grey overflow-hidden h-auto">
            <span class="text-3xl text-grey px-3 border-r-2 border-grey content-center pt-auto ">+</span>
            <textarea class="w-full px-4 pt-auto overflow-x-scroll " placeholder="Message to "></textarea>
        </div>
    </div>
</div>
	




@code
{
    private string apiUrl = "https://localhost:7000/api/pets/";
    Location location;
    Animal animal;
    CreatePetInfo petInfo = new CreatePetInfo();
    CreatePetResponse response = null;
    string status;
    MemoryStream fileData = null;
    IFileListEntry file;
    string string64;
    async Task HandleSelection(IFileListEntry[] files)
    {
        file = files.FirstOrDefault();
        if (file != null)
        {
            // Just load into .NET memory to show it can be done
            // Alternatively it could be saved to disk, or parsed in memory, or similar
            fileData = new MemoryStream();
            await file.Data.CopyToAsync(fileData);
            string64 = Convert.ToBase64String(fileData.ToArray());
            status = $"Finished loading {file.Size} bytes from {file.Name}";
        }
    }


    protected override async Task OnInitializedAsync()
    {
        location = await LocationService.GetLocationAsync();
    }
    public enum Animal
    {
        Dog,
        Cat,
        Fish,
        Turtle,
        Rabbit,
        Parrot,
        Hamster
    }
    public enum Gen
    {
        Male,
        Female
    }
    public class CreatePetInfo
    {

        public string Name { get; set; }
        public Animal Species { get; set; }
        public Gen Genre { get; set; }
        public string Username { get; set; }
        public string Description { get; set; }
        public DateTime BirthDate { get; set; }
        public double Latitude { get; set; }
        public double Longitude { get; set; }
        public string ImageData { get; set; }

    }
    private async void CreatePet()
    {
        petInfo.Longitude = (double)location.Longitude;
        petInfo.Latitude = (double)location.Latitude;
        petInfo.Username = "mike97m";

        petInfo.ImageData = string64;
        response = await Http.PostJsonAsync<CreatePetResponse>(apiUrl, petInfo);
        if (response.success)
            NavigationManager.NavigateTo("/");

    }

    public class CreatePetResponse
    {
        public bool success { get; set; }
    }
}